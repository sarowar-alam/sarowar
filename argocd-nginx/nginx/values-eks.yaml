# values-eks-fix.yaml
global:
  image:
    tag: "v2.8.0"

server:
  service:
    type: LoadBalancer
    annotations:
      # Use external traffic policy to preserve client IP and help with SG
      service.beta.kubernetes.io/aws-load-balancer-type: "external"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
      service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
      
      # Security group annotations
      service.beta.kubernetes.io/aws-load-balancer-security-groups: "auto-create"
      service.beta.kubernetes.io/aws-load-balancer-extra-security-groups: ""

  # Add external traffic policy
  externalTrafficPolicy: Local

  extraArgs:
    - --insecure
    - --rootpath=/

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

configs:
  params:
    server.insecure: true

controller:
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

repoServer:
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

redis:
  enabled: true